<div class="container my-5">
    <h1 class="text-center text-ul">QR Buddy</h1>
    <div class="row">
        <div class="col-6">
            <h2>Create QR Code from URL</h2>
            <div id="url-form-container">
                <form action="" id="url-form">
                    <label>
                        URL<br>
                        <input type="text" class="link-input" placeholder="https://github.com">
                    </label>
                    <div class="">
                        <input type="submit" class="btn btn-primary link-submit" value="Submit">
                    </div>
                </form>
            </div>
            <div class="url-img-container text-center" style="font-size: 2.2rem"></div>
            <hr>
            <h3 class="text-center">Links Created</h3>
            <div id="links"></div>
        </div>
        <div class="col-6">
            <h3 class="text-center">vCards Created</h3>
            <div id="vcards"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    'use strict';

    // Handle link form submission
    (function(){
        var linkSubmit  = document.querySelector('.link-submit'),
            linkInput   = document.querySelector('.link-input'),
            qrContainer = document.querySelector('.url-img-container');

        linkSubmit.addEventListener('click', function(e){
            e.preventDefault();

            ajax({
                url: '/api/v1/url',
                method: 'PUT',
                dataType: 'json',
                data: JSON.stringify({ url: linkInput.value }),
                success: function(data){

                    // Clear contents
                    qrContainer.innerHTML = '';

                    // Full-screen link
                    var imgAnchor = document.createElement('a');
                    imgAnchor.innerText = 'View Fullscreen';
                    imgAnchor.setAttribute('target', '_blank');
                    imgAnchor.setAttribute('rel', 'noopener');
                    imgAnchor.href = data.svgUrl;
                    qrContainer.appendChild(imgAnchor);

                    // Display the QR image
                    var img = document.createElement('img');
                    img.src = data.svgUrl;
                    qrContainer.appendChild(img);

                    // Add a link to the submitted URL
                    var urlAnchor = document.createElement('a');
                    urlAnchor.innerText = data.data;
                    urlAnchor.setAttribute('target', '_blank');
                    urlAnchor.setAttribute('rel', 'noopener');
                    urlAnchor.href = data.data;
                    qrContainer.appendChild(urlAnchor);
                },
                error: function(xhr, status, err){
                    console.log(xhr);
                    console.log(status);
                    console.log(err);
                }
            });

        });
    })();

    (function(){
        ajax({
            url: '/api/v1/url',
            method: 'GET',
            dataType: 'json',
            success: function(data){
                data.forEach(function(item){
                    var html = `
                        <p>
                            <a href="${ item.apiUrl }" target="_blank" rel="noopener" style="font-family: monospace">${ item.id }</a><br>
                            <strong>Created:</strong> ${ item.created }<br>
                        </p>
                    `;

                    document.getElementById('links').innerHTML += html;
                });
            },
            error: function(xhr, status, err){
                console.log(xhr);
                console.log(status);
                console.log(err);
            }
        })
    })();
</script>
