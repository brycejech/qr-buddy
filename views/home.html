<div class="container my-5">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <h2>Create QR Code from URL</h2>
            <div id="url-form-container">
                <form action="" id="url-form">
                    <label>
                        URL<br>
                        <input type="text" class="link-input" placeholder="https://github.com">
                    </label>
                    <div class="">
                        <input type="submit" class="btn btn-primary link-submit" value="Submit">
                    </div>
                </form>
            </div>
            <div class="url-img-container text-center mb-5" style="font-size: 2.2rem"></div>
            <h3 class="text-center">Links Created</h3>
            <div id="links" style="max-height: 250px; overflow-y: scroll;"></div>
        </div>
        <hr>
        <div class="col-md-8 col-md-offset-2">
            <h2>Create QR Code from vCard</h2>
            <div id="vcard-form-container mb-5">
                <form action="" id="vcard-form">
                    <div class="row">
                        <div class="col-6">
                            <label>
                                First Name
                                <input type="text" class="firstName" placeholder="John">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Last Name
                                <input type="text" class="lastName" placeholder="Doe">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-3">
                            <label>
                                Prefix
                                <input type="text" class="prefix" placeholder="Mr.">
                            </label>
                        </div>
                        <div class="col-xs-6 col-sm-3">
                            <label>
                                Suffix
                                <input type="text" class="suffix" placeholder="Sr.">
                            </label>
                        </div>
                        <div class="col-xs-12 col-sm-6">
                            <label>
                                Nickname
                                <input type="text" class="nickname" placeholder="Johnny">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Organization
                                <input type="text" class="organization" placeholder="Organization">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Title
                                <input type="text" class="title" placeholder="Job Title">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label>
                                Website
                                <input type="text" class="website" placeholder="https://website.com">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Home Email
                                <input type="text" class="homeEmail" placeholder="jdoe@home.com">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Work Email
                                <input type="text" class="workEmail" placeholder="jdoe@work.com">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Cell Phone
                                <input type="text" class="cellPhone" placeholder="Cell Phone">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Work Phone
                                <input type="text" class="workPhone" placeholder="Work Phone">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Home Phone
                                <input type="text" class="homePhone" placeholder="Home Phone">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Pager
                                <input type="text" class="pager" placeholder="Pager">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Home Fax
                                <input type="text" class="homeFax" placeholder="Home Fax">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Work Fax
                                <input type="text" class="workFax" placeholder="Work Fax">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label>
                                Birthday
                                <input type="text" class="birthday" placeholder="06/06/1980">
                            </label>
                        </div>
                        <div class="col-6">
                            <label>
                                Anniversary
                                <input type="text" class="anniversary" placeholder="06/06/2000">
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label>
                                Notes
                                <textarea class="notes" placeholder="Notes" rows="6"></textarea>
                            </label>
                        </div>
                    </div>
                    <input type="submit" class="vCard-submit btn btn-primary" value="Submit">
                </form>
            </div>

            <h3 class="text-center">vCards Created</h3>
            <div id="vcards"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    'use strict';

    // Handle link form submission
    (function(){
        var linkSubmit  = document.querySelector('.link-submit'),
            linkInput   = document.querySelector('.link-input'),
            qrContainer = document.querySelector('.url-img-container');

        linkSubmit.addEventListener('click', function(e){
            e.preventDefault();

            ajax({
                url: '/api/v1/url',
                method: 'PUT',
                dataType: 'json',
                data: JSON.stringify({ url: linkInput.value }),
                success: function(data){

                    // Clear contents
                    qrContainer.innerHTML = '';

                    // Full-screen link
                    var imgAnchor = document.createElement('a');
                    imgAnchor.innerText = 'View Fullscreen';
                    imgAnchor.setAttribute('target', '_blank');
                    imgAnchor.setAttribute('rel', 'noopener');
                    imgAnchor.href = data.svgUrl;
                    qrContainer.appendChild(imgAnchor);

                    // Display the QR image
                    var img = document.createElement('img');
                    img.src = data.svgUrl;
                    qrContainer.appendChild(img);

                    // Add a link to the submitted URL
                    var urlAnchor = document.createElement('a');
                    urlAnchor.innerText = data.data;
                    urlAnchor.setAttribute('target', '_blank');
                    urlAnchor.setAttribute('rel', 'noopener');
                    urlAnchor.href = data.data;
                    qrContainer.appendChild(urlAnchor);
                },
                error: function(xhr, status, err){
                    console.log(xhr);
                    console.log(status);
                    console.log(err);
                }
            });

        });
    })();

    // Handle contact form submission
    (function(){
        var vCardForm = document.getElementById('vcard-form'),
            submitBtn = vCardForm.querySelector('.vCard-submit');

        submitBtn.addEventListener('click', function(e){
            e.preventDefault();

            var data = getFormData();

            console.log(data);
        });

        var inputs = [
            // Name
            'firstName', 'lastName','prefix','suffix','nickname',
            // Org
            'organization','title','website',
            // Emails
            'homeEmail','workEmail',
            // Phones
            'cellPhone','workPhone','homePhone','pager',
            // Faxes
            'homeFax','workFax',
            // Dates
            'birthday','anniversary',
            //Notes
            'notes'
        ];

        function getFormData(){
            var data = {}

            inputs.forEach(function(name){
                var el = vCardForm.querySelector('.' + name);

                data[name] = el.value;
            });

            return data;
        }
    })();

    (function(){
        ajax({
            url: '/api/v1/url',
            method: 'GET',
            dataType: 'json',
            success: function(data){
                data.forEach(function(item){
                    var html = `
                        <p>
                            <a href="${ item.apiUrl }" target="_blank" rel="noopener" style="font-family: monospace">${ item.id }</a><br>
                            <strong>Created:</strong> ${ item.created }<br>
                        </p>
                    `;

                    document.getElementById('links').innerHTML += html;
                });
            },
            error: function(xhr, status, err){
                console.log(xhr);
                console.log(status);
                console.log(err);
            }
        })
    })();
</script>
